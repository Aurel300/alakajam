{% macro entryThumb(entry, cols = 3, options = {}) %}
<div class="col-sm-4 col-md-{{ cols }}">
  <div class="entry-thumb">
    {% set picturePath = entry.get('pictures')[0] if entry.get('pictures').length > 0 else '/static/images/default-entry.png' %}
    <a href="{{ buildUrl(entry, 'entry') }}">
      <div class="entry-thumb__picture" style="background-image: url('{{ picturePath }}')">
        <div class="entry-thumb__picture-gradient"></div>
      </div>
      <div class="entry-thumb__title">{{ entry.get('title') }}</div>
    </a>
    <div class="entry-thumb__author" >by 
      {% for userRole in entry.related('userRoles').models %}
       <a href="{{ buildUrl(userRole, 'user') }}">
        {{ userRole.get('user_title') }}{{ ', ' if not loop.last }}
       </a>
      {% endfor %}
    </div>
    {% if options.showEvent %}
      <div class="entry-thumb__event" >
        on <a href="{{ buildUrl(entry.related('event'), 'event') }}">{{ entry.related('event').get('title') }}</a>
      </div>
    {% endif %}
  </div>
</div>
{% endmacro %}

{% macro entrySmallThumb(entry, cols = 4) %}
<div class="col-xs-6 col-md-{{ cols }}">
  <div class="entry-small-thumb">
    {% if entry.get('id') %}
      {% set picturePath = entry.get('pictures')[0] if entry.get('pictures').length > 0 else '/static/images/default-entry.png' %}
      <div class="entry-small-thumb__details">
        <a href="{{ buildUrl(entry, 'entry') }}">
          <div class="entry-small-thumb__picture" style="background-image: url('{{ picturePath }}')"></div>
          <div class="entry-small-thumb__title"  href="{{ buildUrl(entry, 'entry') }}">
            {{ entry.get('title') }}
          </div>
        </a>
        <div class="entry-small-thumb__author" >by 
        {% for userRole in entry.related('userRoles').models %}
         <a href="{{ buildUrl(userRole, 'user') }}">
          {{ userRole.get('user_title') }}{{ ', ' if not loop.last }}
         </a>
        {% endfor %}
        </div>
      </div>
    {% else %}
      <div class="text-center"><h4 style="padding-top: 18px">No entry</h4></div>
    {% endif %}
  </div>
</div>
{% endmacro %}

{% macro eventTable(event, withEntries = true, entryCols = 4, options = {}) %}
  <div class="event-table {{ 'live' if not options.neutralStatus and event.get('status') === 'open' }}">
    <div class="row">
      <div class="col-md-12">
        <a class="event-table__header" href="{{ buildUrl(event, 'event') }}">
          <div class="row">
            <div class="col-sm-7">
              <h2>
                {% if not options.neutralStatus %}
                  {% if event.get('status') === 'pending' %}
                    <span class="label label-default event-table__status">Upcoming</span>
                  {% elseif event.get('status') === 'open' %}
                    <span class="label label-danger event-table__status">Live!</span>
                  {% endif %}
                {% endif %}
                {{ event.get('title') }}
              </h2>
            </div>
            <div class="col-sm-5 text-right event-table__theme">
              
            </div>
          </div>
        </a>
        <div class="event-table__details">
          <div class="row">
            <div class="col-sm-5">
              <div class="event-table__detail">
                <span class="glyphicon glyphicon-calendar"></span> {{ event.get('display_dates') or '(dates unknown)' }}
              </div>
            </div>
            {% if event.get('display_theme') %}
            <div class="col-sm-4">
              <div class="event-table__detail">
                <span class="glyphicon glyphicon-grain"></span> {{ event.get('display_theme') }}
              </div>
            </div>
            {% endif %}
            {% if event.related('entries').length > 0 %}
            <div class="col-sm-3">
              <div class="event-table__detail">
                <span class="glyphicon glyphicon-tower"></span>
                {{ event.related('entries').length }} game{{ 's' if event.related('entries').length > 1 }}
              </div>
            </div>
            {% endif %}
          </div>
          <div class="row">
            <div class="col-xs-12">
              <div class="event-table__links">
                {{ eventLinks(event, options.latestEventAnnouncement, options.path) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--
    {% if withEntries %}
    <div class="row">
      {% for entry in event.related('entries').models %}
        {{ entrySmallThumb(entry, entryCols) }}
      {% endfor %}
    </div>
    {% endif %}
    -->
  </div>
{% endmacro %}


{% macro eventSmallTable(event) %}
<div class="panel event-small-table">
  <div class="row">
    <div class="col-xs-12">
      <a class="event-small-table__header" href="{{ buildUrl(event, 'event') }}">
        <h2>
          {% if not options.neutralStatus %}
            {% if event.get('status') === 'pending' %}
              <span class="label label-default event-table__status">Upcoming</span>
            {% elseif event.get('status') === 'open' %}
              <span class="label label-danger event-table__status">Live!</span>
            {% endif %}
          {% endif %}
          {{ event.get('title') }}
        </h2>
      </a>
    </div>
  </div>
  <div class="row event-small-table__details">
    <div class="col-xs-12">
      <span class="glyphicon glyphicon-calendar"></span> {{ event.get('display_dates') or '(dates unknown)' }}
      {% if event.get('display_theme') %}
      &nbsp;<span class="glyphicon glyphicon-grain"></span> {{ event.get('display_theme') }}
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}


{% macro eventLinks (event, latestEventAnnouncement, path) %}

<!-- TODO Refactor using a macro -->
{% if latestEventAnnouncement %}
  <a href="{{ buildUrl(event, 'event', 'announcements') }}" class="hidden-xs event-header__link {{ 'active' if path == buildUrl(event, 'event', 'announcements') }} event-header__announcement">
    <span class="glyphicon glyphicon-pushpin"></span> {{ latestEventAnnouncement.get('title')}}
    <span class="event-header__announcement-info">
      Announcement â€¢ {{ latestEventAnnouncement.get('created_at') | relativeTime }}
    </span>
  </a><!--
  --><a href="{{ buildUrl(event, 'event', 'announcements') }}" class="hidden-sm hidden-md hidden-lg event-header__link {{ 'active' if path == buildUrl(event, 'event', 'announcements') }}">
    <span class="glyphicon glyphicon-pushpin"></span>
  </a><!--
-->{% endif %}<!--
--><a href="{{ buildUrl(event, 'event', 'posts') }}" class="event-header__link {{ 'active' if path == buildUrl(event, 'event', 'posts') }}">
  <span class="glyphicon glyphicon-globe"></span> <span class="event-header__link-label">Posts</span>
</a><!--
-->{% if event.get('status_theme') !== 'disabled' %}<a href="{{ buildUrl(event, 'event', 'themes') }}" class="event-header__link {{ 'active' if path == buildUrl(event, 'event', 'themes') }} {{ 'disabled' if event.get('status_theme') === 'off' }}">
  <span class="glyphicon glyphicon-grain"></span> <span class="event-header__link-label">Theme</span>
</a>{% endif %}<!--
-->{% if event.get('status_entry') !== 'disabled' %}<a href="{{ buildUrl(event, 'event', 'games') }}" class="event-header__link {{ 'active' if path == buildUrl(event, 'event', 'games') }} {{ 'disabled' if event.get('status_entry') === 'off' }}">
  <span class="glyphicon glyphicon-tower"></span> <span class="event-header__link-label">Games</span>
</a>{% endif %}<!--
-->{% if event.get('status_results') !== 'disabled' %}<a href="{{ buildUrl(event, 'event', 'results') }}" class="event-header__link {{ 'active' if path == buildUrl(event, 'event', 'results') }} {{ 'disabled' if event.get('status_results') === 'off' }}">
  <span class="glyphicon glyphicon-th-list"></span> <span class="event-header__link-label">Results</span>
</a>{% endif %}

{% endmacro %}