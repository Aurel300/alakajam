{% extends "_page.html" %}
{% import "event/_macros-event.html" as eventMacros %}
{% import "post/_macros-post.html" as postMacros %}

{% block styles %}
<link rel="stylesheet" href="/static/css/flipclock-custom.css" />
{% endblock %}

{% block body %}

<div class="container">
  <div class="row">

    <div class="col-lg-offset-1 col-lg-10">
      <div class="home-jumbo {{ 'live' if liveEvent }}">
        {% if liveEvent %}
  
          <h1><a href="{{ buildUrl(liveEvent, 'event') }}">{{ liveEvent.get('title') }}</a> {{ liveEvent.get('countdown_config').phrase | default('ends in') }}</h1>
          <div class="home-jumbo__countdown js-countdown"></div>
          {% if liveEvent.get('display_theme') %}
            {% if liveEvent.get('status_theme') !== 'off' and liveEvent.get('status_theme') !== 'disabled' %}
              <h1>Theme: <a href="{{ buildUrl(liveEvent, 'event', 'themes') }}">{{ liveEvent.get('display_theme') }}</a></h1>
            {% else %}
              <h1>Theme: {{ liveEvent.get('display_theme') }}</h1>
            {% endif %}
          {% endif %}

          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              {{ eventMacros.eventTable(liveEvent, { hideLinks: true }) }}
            </div>
          </div>

          <div class="row">
            <div class="col-xs-12 text-center home-jumbo__links">
              {{ eventMacros.eventBigLink(liveEvent, null, 'announcements', 'News', 'pushpin') }}
              {{ eventMacros.eventBigLink(liveEvent, null, 'posts', 'Posts', 'globe') }}
              {{ eventMacros.eventBigLink(liveEvent, 'status_theme', 'theme', 'Theme', 'grain') }}
              {{ eventMacros.eventBigLink(liveEvent, 'status_entry', 'games', 'Games', 'tower') }}
              {{ eventMacros.eventBigLink(liveEvent, 'status_results', 'results', 'Results', 'th-list') }}
            </div>
          </div>
        
        {% elseif nextEvents and nextEvents.length > 0 %}
        
          {% set upcomingEvent = nextEvents[0] %}
          <h1><a href="{{ buildUrl(upcomingEvent, 'event') }}">{{ upcomingEvent.get('title') }}</a> {{ 'starts ' + upcomingEvent.get('display_dates') if upcomingEvent.get('display_dates') else 'will come soon!' }}</h1></h1>
          <div class="home-jumbo__countdown js-countdown"></div>

        {% else %}
          <h1>Next event not announced yet.</h1>
        {% endif %}

        <div class="row">
          <div class="col-xs-12 text-center home-jumbo__social">
            Follow the news on 
            <a href="https://twitter.com/AlakajamBang">
              <img src="/static/images/twitter.svg" class="footer__icon no-border" /> 
              <strong>@AlakajamBang</strong>
            </a>
          </div>
        </div>
      </div>
    </div>
    
    {% for nextEvent in nextEvents %}
      {{ eventMacros.eventTable(nextEvent, { latestEventAnnouncement: nextEventsAnnouncements[loop.index0], path: path }) }}
    {% endfor %}
    
  </div>
  <div class="row">
    <div class="col-lg-offset-1 col-lg-10 home-announcement">
      {% if homeAnnouncement %}
        {{ postMacros.post(homeAnnouncement, user) }}
        <div class="text-right">
          <a href="/announcements" class="btn btn-sm btn-default">Browse announcements <span class="glyphicon glyphicon-chevron-right"></span></a>
        </div>
      {% endif %}
      {% if posts.length > 0 %}
      <div class="horizontal-bar">Latest posts</div>
      {% endif %}
      {% for post in posts %}
        {{ postMacros.post(post, user) }}
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}

{% if liveEvent %}
  {% set countdownEvent = liveEvent %}
{% elseif nextEvents and nextEvents.length > 0 %}
  {% set countdownEvent = nextEvents[0] %}
{% endif %}

{% if countdownEvent and countdownEvent.get('countdown_config').date %}
  <script type="text/javascript" src="/static/js/flipclock.min.js"></script>
  <script type="text/javascript">
  let diffMs = Math.max(0, Date.parse('{{ countdownEvent.get('countdown_config').date }}') - Date.now())
  $('.js-countdown').FlipClock(diffMs / 1000, { 
    clockFace: 'DailyCounter',
    countdown: true
  });
  </script>
{% endif %}

{% endblock %}