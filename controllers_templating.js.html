<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/templating.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/templating.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

/**
 * Utilities made available in all templates
 *
 * @module controllers/templating
 */

const constants = require('../core/constants')
const forms = require('../core/forms')
const securityService = require('../services/security-service')
const postService = require('../services/post-service')

const DASHBOARD_PAGES = ['feed', 'posts', 'invite', 'settings', 'password']

module.exports = {
  buildUrl,

  min: Math.min,
  max: Math.max,

  isId: forms.isId,

  isPast: postService.isPast,
  wasEdited: postService.wasEdited,

  canUserRead: securityService.canUserRead,
  canUserWrite: securityService.canUserWrite,
  canUserManage: securityService.canUserManage,
  isAdmin: securityService.isAdmin,
  isMod: securityService.isMod
}

function buildUrl (model, type, page = null, options = {}) {
  try {
    let pagePath = (page ? '/' + page : '')

    if (type === 'event') {
      // Event model
      if (model &amp;&amp; model.id) {
        if (page === 'posts') {
          pagePath = ''
        }
        return '/' + model.get('name') + pagePath
      } else {
        return '/create-event'
      }
    } else if (type === 'entry') {
      // Entry model
      if (model &amp;&amp; model.id) {
        return '/' + model.get('event_name') + '/' + model.id + '/' + model.get('name') + pagePath
      } else {
        return '/' + model.get('event_name') + '/create-entry'
      }
    } else if (type === 'user') {
      // User Role model / User model
      if (DASHBOARD_PAGES.indexOf(page) !== -1) {
        if (options.dashboardAdminMode) {
          page += '?user=' + model.get('name')
        }
        return '/dashboard/' + page
      } else {
        let userId = model.get('name') || model.get('user_name')
        return '/user/' + userId + pagePath
      }
    } else if (type === 'post') {
      // Post model
      if (page === 'create') {
        pagePath += '?'
        if (options.eventId) pagePath += 'eventId=' + options.eventId
        if (options.entryId) pagePath += '&amp;entryId=' + options.entryId
        if (options.specialPostType) pagePath += '&amp;special_post_type=' + options.specialPostType
        if (options.title) pagePath += '&amp;title=' + options.title
        return '/post' + pagePath
      } else if (model &amp;&amp; typeof model === 'object') {
        if (model.get('special_post_type') === constants.SPECIAL_POST_TYPE_ARTICLE &amp;&amp; !page) {
          return '/article/' + model.get('name')
        } else {
          return '/post/' + model.id + '/' + (model.get('name') || 'untitled') + pagePath
        }
      } else {
        return '/post/' + model
      }
    } else if (type === 'comment') {
      // Comment model
      let pageParams = ''
      if (model &amp;&amp; page === 'edit') {
        pageParams = 'editComment=' + model.id
      }
      return '?' + pageParams + (model ? '#c' + model.id : '')
    }
  } catch (e) {
    throw new Error('Failed to build URL for model "' + model + '" of type "' + type + '": ' + e.message)
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers.html">controllers</a></li><li><a href="module-controllers_api-controller.html">controllers/api-controller</a></li><li><a href="module-controllers_entry-controller.html">controllers/entry-controller</a></li><li><a href="module-controllers_event-controller.html">controllers/event-controller</a></li><li><a href="module-controllers_main-controller.html">controllers/main-controller</a></li><li><a href="module-controllers_post-controller.html">controllers/post-controller</a></li><li><a href="module-controllers_templating.html">controllers/templating</a></li><li><a href="module-controllers_user-controller.html">controllers/user-controller</a></li><li><a href="module-core_cache.html">core/cache</a></li><li><a href="module-core_constants.html">core/constants</a></li><li><a href="module-core_db.html">core/db</a></li><li><a href="module-core_file-storage.html">core/file-storage</a></li><li><a href="module-core_forms.html">core/forms</a></li><li><a href="module-core_log.html">core/log</a></li><li><a href="module-core_middleware.html">core/middleware</a></li><li><a href="module-core_models.html">core/models</a></li><li><a href="module-server.html">server</a></li><li><a href="module-services_event-service.html">services/event-service</a></li><li><a href="module-services_event-theme-service.html">services/event-theme-service</a></li><li><a href="module-services_invite-service.html">services/invite-service</a></li><li><a href="module-services_post-service.html">services/post-service</a></li><li><a href="module-services_security-service.html">services/security-service</a></li><li><a href="module-services_session-service.html">services/session-service</a></li><li><a href="module-services_setting-service.html">services/setting-service</a></li><li><a href="module-services_user-service.html">services/user-service</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Aug 18 2017 11:59:09 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
